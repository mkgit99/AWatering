<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AWatering: C:/Users/mnich/Desktop/AWatering/Drivers/STM32F3xx_HAL_Driver/Src/stm32f3xx_hal_adc.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AWatering
   &#160;<span id="projectnumber">1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_d522931ffa1371640980b621734a4381.html">Users</a></li><li class="navelem"><a class="el" href="dir_3cc0367cb661f76f78eb5ce96b1e8f1b.html">mnich</a></li><li class="navelem"><a class="el" href="dir_50f336f51fffdf1ee3547914d4a1aebc.html">Desktop</a></li><li class="navelem"><a class="el" href="dir_e62391ac6d793e07045e631e11b91adf.html">AWatering</a></li><li class="navelem"><a class="el" href="dir_8da1178efada2d49fd9b631ba4c26a52.html">Drivers</a></li><li class="navelem"><a class="el" href="dir_666fd95379817a39fa6af568ed30ef0d.html">STM32F3xx_HAL_Driver</a></li><li class="navelem"><a class="el" href="dir_8142d8880358f6dd872c81b5530c84ab.html">Src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">stm32f3xx_hal_adc.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>This file provides firmware functions to manage the following functionalities of the Analog to Digital Convertor (ADC) peripheral:  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="stm32f3xx__hal_8h_source.html">stm32f3xx_hal.h</a>&quot;</code><br />
</div><a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This file provides firmware functions to manage the following functionalities of the Analog to Digital Convertor (ADC) peripheral: </p>
<dl class="section author"><dt>Author</dt><dd>MCD Application Team<ul>
<li>Initialization and de-initialization functions ++ Initialization and Configuration of ADC</li>
<li>Operation functions ++ Start, stop, get result of conversions of regular group, using 3 possible modes: polling, interruption or DMA.</li>
<li>Control functions ++ Channels configuration on regular group ++ Channels configuration on injected group ++ Analog Watchdog configuration</li>
<li>State functions ++ ADC state machine management ++ Interrupts and flags management Other functions (extended functions) are available in file "stm32f3xx_hal_adc_ex.c".</li>
</ul>
</dd></dl>
<pre class="fragment">==============================================================================
                   ##### ADC peripheral features #####
==============================================================================
[..] 
(+) 12-bit, 10-bit, 8-bit or 6-bit configurable resolution (available only on 
    STM32F30xxC devices).

(+) Interrupt generation at the end of regular conversion, end of injected
    conversion, and in case of analog watchdog or overrun events.

(+) Single and continuous conversion modes.

(+) Scan mode for conversion of several channels sequentially.

(+) Data alignment with in-built data coherency.

(+) Programmable sampling time (channel wise)

(+) ADC conversion of regular group and injected group.

(+) External trigger (timer or EXTI) with configurable polarity
    for both regular and injected groups.

(+) DMA request generation for transfer of conversions data of regular group.

(+) Multimode dual mode (available on devices with 2 ADCs or more).

(+) Configurable DMA data storage in Multimode Dual mode (available on devices
    with 2 DCs or more).

(+) Configurable delay between conversions in Dual interleaved mode (available 
    on devices with 2 DCs or more).

(+) ADC calibration

(+) ADC channels selectable single/differential input (available only on
    STM32F30xxC devices)

(+) ADC Injected sequencer&amp;channels configuration context queue (available 
    only on STM32F30xxC devices)

(+) ADC offset on injected and regular groups (offset on regular group 
    available only on STM32F30xxC devices)

(+) ADC supply requirements: 2.4 V to 3.6 V at full speed and down to 1.8 V at 
    slower speed.

(+) ADC input range: from Vref- (connected to Vssa) to Vref+ (connected to 
    Vdda or to an external voltage reference).


                   ##### How to use this driver #####
==============================================================================
  [..]

   *** Configuration of top level parameters related to ADC ***
   ============================================================
   [..]

  (#) Enable the ADC interface
    (++) As prerequisite, ADC clock must be configured at RCC top level.
    
      (++) For STM32F30x/STM32F33x devices:
           Two possible clock sources: synchronous clock derived from AHB clock 
           or asynchronous clock derived from ADC dedicated PLL 72MHz.
            - Synchronous clock is mandatory since used as ADC core clock.
              Synchronous clock can be used optionally as ADC conversion clock, depending on ADC init structure clock setting.
              Synchronous clock is configured using macro __ADCx_CLK_ENABLE().
            - Asynchronous can be used optionally as ADC conversion clock, depending on ADC init structure clock setting.
              Asynchronous clock is configured using function HAL_RCCEx_PeriphCLKConfig().
           (+++) For example, in case of device with a single ADC:
                 Into HAL_ADC_MspInit() (recommended code location) or with
                 other device clock parameters configuration:
             (+++) __HAL_RCC_ADC1_CLK_ENABLE()                            (mandatory)
             (+++) PeriphClkInit.PeriphClockSelection = RCC_PERIPHCLK_ADC (optional, if ADC conversion from asynchronous clock)
             (+++) PeriphClkInit.Adc1ClockSelection = RCC_ADC1PLLCLK_DIV1 (optional, if ADC conversion from asynchronous clock)
             (+++) HAL_RCCEx_PeriphCLKConfig(&amp;RCC_PeriphClkInitStructure) (optional, if ADC conversion from asynchronous clock)

           (+++) For example, in case of device with 4 ADCs:

             (+++) if((hadc-&gt;Instance == ADC1) || (hadc-&gt;Instance == ADC2))   
             (+++) {                                                          
             (+++)   __HAL_RCC_ADC12_CLK_ENABLE()                             (mandatory)
             (+++)   PeriphClkInit.PeriphClockSelection = RCC_PERIPHCLK_ADC   (optional, if ADC conversion from asynchronous clock)
             (+++)   PeriphClkInit.Adc12ClockSelection = RCC_ADC12PLLCLK_DIV1 (optional, if ADC conversion from asynchronous clock)
             (+++)   HAL_RCCEx_PeriphCLKConfig(&amp;RCC_PeriphClkInitStructure)   (optional, if ADC conversion from asynchronous clock)
             (+++) }                                                          
             (+++) else                                                       
             (+++) {                                                          
             (+++)   __HAL_RCC_ADC34_CLK_ENABLE()                              (mandatory)
             (+++)   PeriphClkInit.Adc34ClockSelection = RCC_ADC34PLLCLK_DIV1; (optional, if ADC conversion from asynchronous clock)
             (+++)   HAL_RCCEx_PeriphCLKConfig(&amp;RCC_PeriphClkInitStructure);   (optional, if ADC conversion from asynchronous clock)
             (+++) }                                                          
    
      (++) For STM32F37x devices:
           One clock setting is mandatory: 
           ADC clock (core and conversion clock) from APB2 clock.
           (+++) Example:
                 Into HAL_ADC_MspInit() (recommended code location) or with
                 other device clock parameters configuration:
             (+++) PeriphClkInit.PeriphClockSelection = RCC_PERIPHCLK_ADC
             (+++) PeriphClkInit.AdcClockSelection = RCC_ADCPLLCLK_DIV2
             (+++) HAL_RCCEx_PeriphCLKConfig(&amp;PeriphClkInit)

  (#) ADC pins configuration
       (++) Enable the clock for the ADC GPIOs
            using macro __HAL_RCC_GPIOx_CLK_ENABLE()
       (++) Configure these ADC pins in analog mode
            using function HAL_GPIO_Init()

  (#) Optionally, in case of usage of ADC with interruptions:
       (++) Configure the NVIC for ADC
            using function HAL_NVIC_EnableIRQ(ADCx_IRQn)
       (++) Insert the ADC interruption handler function HAL_ADC_IRQHandler() 
            into the function of corresponding ADC interruption vector 
            ADCx_IRQHandler().

  (#) Optionally, in case of usage of DMA:
       (++) Configure the DMA (DMA channel, mode normal or circular, ...)
            using function HAL_DMA_Init().
       (++) Configure the NVIC for DMA
            using function HAL_NVIC_EnableIRQ(DMAx_Channelx_IRQn)
       (++) Insert the ADC interruption handler function HAL_ADC_IRQHandler() 
            into the function of corresponding DMA interruption vector 
            DMAx_Channelx_IRQHandler().

   *** Configuration of ADC, groups regular/injected, channels parameters ***
   ==========================================================================
   [..]

  (#) Configure the ADC parameters (resolution, data alignment, ...)
      and regular group parameters (conversion trigger, sequencer, ...)
      using function HAL_ADC_Init().

  (#) Configure the channels for regular group parameters (channel number, 
      channel rank into sequencer, ..., into regular group)
      using function HAL_ADC_ConfigChannel().

  (#) Optionally, configure the injected group parameters (conversion trigger, 
      sequencer, ..., of injected group)
      and the channels for injected group parameters (channel number, 
      channel rank into sequencer, ..., into injected group)
      using function HAL_ADCEx_InjectedConfigChannel().

  (#) Optionally, configure the analog watchdog parameters (channels
      monitored, thresholds, ...)
      using function HAL_ADC_AnalogWDGConfig().

  (#) Optionally, for devices with several ADC instances: configure the 
      multimode parameters
      using function HAL_ADCEx_MultiModeConfigChannel().

   *** Execution of ADC conversions ***
   ====================================
   [..]

  (#) Optionally, perform an automatic ADC calibration to improve the
      conversion accuracy
      using function HAL_ADCEx_Calibration_Start().

  (#) ADC driver can be used among three modes: polling, interruption,
      transfer by DMA.

      (++) ADC conversion by polling:
        (+++) Activate the ADC peripheral and start conversions
              using function HAL_ADC_Start()
        (+++) Wait for ADC conversion completion 
              using function HAL_ADC_PollForConversion()
              (or for injected group: HAL_ADCEx_InjectedPollForConversion() )
        (+++) Retrieve conversion results 
              using function HAL_ADC_GetValue()
              (or for injected group: HAL_ADCEx_InjectedGetValue() )
        (+++) Stop conversion and disable the ADC peripheral 
              using function HAL_ADC_Stop()

      (++) ADC conversion by interruption: 
        (+++) Activate the ADC peripheral and start conversions
              using function HAL_ADC_Start_IT()
        (+++) Wait for ADC conversion completion by call of function
              HAL_ADC_ConvCpltCallback()
              (this function must be implemented in user program)
              (or for injected group: HAL_ADCEx_InjectedConvCpltCallback() )
        (+++) Retrieve conversion results 
              using function HAL_ADC_GetValue()
              (or for injected group: HAL_ADCEx_InjectedGetValue() )
        (+++) Stop conversion and disable the ADC peripheral 
              using function HAL_ADC_Stop_IT()

      (++) ADC conversion with transfer by DMA:
        (+++) Activate the ADC peripheral and start conversions
              using function HAL_ADC_Start_DMA()
        (+++) Wait for ADC conversion completion by call of function
              HAL_ADC_ConvCpltCallback() or HAL_ADC_ConvHalfCpltCallback()
              (these functions must be implemented in user program)
        (+++) Conversion results are automatically transferred by DMA into
              destination variable address.
        (+++) Stop conversion and disable the ADC peripheral 
              using function HAL_ADC_Stop_DMA()

      (++) For devices with several ADCs: ADC multimode conversion 
           with transfer by DMA:
        (+++) Activate the ADC peripheral (slave)
              using function HAL_ADC_Start()
              (conversion start pending ADC master)
        (+++) Activate the ADC peripheral (master) and start conversions
              using function HAL_ADCEx_MultiModeStart_DMA()
        (+++) Wait for ADC conversion completion by call of function
              HAL_ADC_ConvCpltCallback() or HAL_ADC_ConvHalfCpltCallback()
              (these functions must be implemented in user program)
        (+++) Conversion results are automatically transferred by DMA into
              destination variable address.
        (+++) Stop conversion and disable the ADC peripheral (master)
              using function HAL_ADCEx_MultiModeStop_DMA()
        (+++) Stop conversion and disable the ADC peripheral (slave)
              using function HAL_ADC_Stop_IT()

   [..]

  (@) Callback functions must be implemented in user program:
    (+@) HAL_ADC_ErrorCallback()
    (+@) HAL_ADC_LevelOutOfWindowCallback() (callback of analog watchdog)
    (+@) HAL_ADC_ConvCpltCallback()
    (+@) HAL_ADC_ConvHalfCpltCallback
    (+@) HAL_ADCEx_InjectedConvCpltCallback()
    (+@) HAL_ADCEx_InjectedQueueOverflowCallback() (for STM32F30x/STM32F33x devices)

   *** Deinitialization of ADC ***
   ============================================================
   [..]

  (#) Disable the ADC interface
    (++) ADC clock can be hard reset and disabled at RCC top level.
      (++) Hard reset of ADC peripherals
           using macro __ADCx_FORCE_RESET(), __ADCx_RELEASE_RESET().
      (++) ADC clock disable
           using the equivalent macro/functions as configuration step.

      (++) For STM32F30x/STM32F33x devices:
         Caution: For devices with several ADCs:
         These settings impact both ADC of common group: ADC1&amp;ADC2, ADC3&amp;ADC4
         if available (ADC2, ADC3, ADC4 availability depends on STM32 product)

           (+++) For example, in case of device with a single ADC:
                 Into HAL_ADC_MspDeInit() (recommended code location) or with
                 other device clock parameters configuration:
             (+++) __HAL_RCC_ADC1_FORCE_RESET()                           (optional)
             (+++) __HAL_RCC_ADC1_RELEASE_RESET()                         (optional)
             (+++) __HAL_RCC_ADC1_CLK_DISABLE()                           (mandatory)
             (+++) PeriphClkInit.PeriphClockSelection = RCC_PERIPHCLK_ADC (optional, if configured before)
             (+++) PeriphClkInit.Adc1ClockSelection = RCC_ADC1PLLCLK_OFF  (optional, if configured before)
             (+++) HAL_RCCEx_PeriphCLKConfig(&amp;RCC_PeriphClkInitStructure) (optional, if configured before)

           (+++) For example, in case of device with 4 ADCs:
             (+++) if((hadc-&gt;Instance == ADC1) || (hadc-&gt;Instance == ADC2))   
             (+++) {                                                          
             (+++)   __HAL_RCC_ADC12_FORCE_RESET()                            (optional)
             (+++)   __HAL_RCC_ADC12_RELEASE_RESET()                          (optional)
             (+++)   __HAL_RCC_ADC12_CLK_DISABLE()                            (mandatory)
             (+++)   PeriphClkInit.PeriphClockSelection = RCC_PERIPHCLK_ADC   (optional, if configured before)
             (+++)   PeriphClkInit.Adc12ClockSelection = RCC_ADC12PLLCLK_OFF  (optional, if configured before)
             (+++)   HAL_RCCEx_PeriphCLKConfig(&amp;RCC_PeriphClkInitStructure)   (optional, if configured before)
             (+++) }                                                          
             (+++) else                                                       
             (+++) {                                                          
             (+++)   __HAL_RCC_ADC32_FORCE_RESET()                            (optional)
             (+++)   __HAL_RCC_ADC32_RELEASE_RESET()                          (optional)
             (+++)   __HAL_RCC_ADC34_CLK_DISABLE()                            (mandatory)
             (+++)   PeriphClkInit.Adc34ClockSelection = RCC_ADC34PLLCLK_OFF  (optional, if configured before)
             (+++)   HAL_RCCEx_PeriphCLKConfig(&amp;RCC_PeriphClkInitStructure)   (optional, if configured before)
             (+++) }                                                          
    
      (++) For STM32F37x devices:
           (+++) Example:
                 Into HAL_ADC_MspDeInit() (recommended code location) or with
                 other device clock parameters configuration:
             (+++) PeriphClkInit.PeriphClockSelection = RCC_PERIPHCLK_ADC
             (+++) PeriphClkInit.AdcClockSelection = RCC_ADCPLLCLK_OFF
             (+++) HAL_RCCEx_PeriphCLKConfig(&amp;PeriphClkInit)

  (#) ADC pins configuration
       (++) Disable the clock for the ADC GPIOs
            using macro __HAL_RCC_GPIOx_CLK_DISABLE()

  (#) Optionally, in case of usage of ADC with interruptions:
       (++) Disable the NVIC for ADC
            using function HAL_NVIC_DisableIRQ(ADCx_IRQn)

  (#) Optionally, in case of usage of DMA:
       (++) Deinitialize the DMA
            using function HAL_DMA_DeInit().
       (++) Disable the NVIC for DMA
            using function HAL_NVIC_DisableIRQ(DMAx_Channelx_IRQn)

  [..]
  
  *** Callback registration ***
  =============================================
  [..]

   The compilation flag USE_HAL_ADC_REGISTER_CALLBACKS, when set to 1,
   allows the user to configure dynamically the driver callbacks.
   Use Functions @ref HAL_ADC_RegisterCallback()
   to register an interrupt callback.
  [..]

   Function @ref HAL_ADC_RegisterCallback() allows to register following callbacks:
     (+) ConvCpltCallback               : ADC conversion complete callback
     (+) ConvHalfCpltCallback           : ADC conversion DMA half-transfer callback
     (+) LevelOutOfWindowCallback       : ADC analog watchdog 1 callback
     (+) ErrorCallback                  : ADC error callback
     (+) InjectedConvCpltCallback       : ADC group injected conversion complete callback
     (+) MspInitCallback                : ADC Msp Init callback
     (+) MspDeInitCallback              : ADC Msp DeInit callback
   This function takes as parameters the HAL peripheral handle, the Callback ID
   and a pointer to the user callback function.
  [..]

   Use function @ref HAL_ADC_UnRegisterCallback to reset a callback to the default
   weak function.
  [..]

   @ref HAL_ADC_UnRegisterCallback takes as parameters the HAL peripheral handle,
   and the Callback ID.
   This function allows to reset following callbacks:
     (+) ConvCpltCallback               : ADC conversion complete callback
     (+) ConvHalfCpltCallback           : ADC conversion DMA half-transfer callback
     (+) LevelOutOfWindowCallback       : ADC analog watchdog 1 callback
     (+) ErrorCallback                  : ADC error callback
     (+) InjectedConvCpltCallback       : ADC group injected conversion complete callback
     (+) MspInitCallback                : ADC Msp Init callback
     (+) MspDeInitCallback              : ADC Msp DeInit callback
   [..]

   By default, after the @ref HAL_ADC_Init() and when the state is @ref HAL_ADC_STATE_RESET
   all callbacks are set to the corresponding weak functions:
   examples @ref HAL_ADC_ConvCpltCallback(), @ref HAL_ADC_ErrorCallback().
   Exception done for MspInit and MspDeInit functions that are
   reset to the legacy weak functions in the @ref HAL_ADC_Init()/ @ref HAL_ADC_DeInit() only when
   these callbacks are null (not registered beforehand).
  [..]

   If MspInit or MspDeInit are not null, the @ref HAL_ADC_Init()/ @ref HAL_ADC_DeInit()
   keep and use the user MspInit/MspDeInit callbacks (registered beforehand) whatever the state.
   [..]

   Callbacks can be registered/unregistered in @ref HAL_ADC_STATE_READY state only.
   Exception done MspInit/MspDeInit functions that can be registered/unregistered
   in @ref HAL_ADC_STATE_READY or @ref HAL_ADC_STATE_RESET state,
   thus registered (user) MspInit/DeInit callbacks can be used during the Init/DeInit.
  [..]

   Then, the user first registers the MspInit/MspDeInit user callbacks
   using @ref HAL_ADC_RegisterCallback() before calling @ref HAL_ADC_DeInit()
   or @ref HAL_ADC_Init() function.
   [..]

   When the compilation flag USE_HAL_ADC_REGISTER_CALLBACKS is set to 0 or
   not defined, the callback registration feature is not available and all callbacks
   are set to the corresponding weak functions.</pre><dl class="section attention"><dt>Attention</dt><dd></dd></dl>
<h2><center>&copy; Copyright (c) 2016 STMicroelectronics. All rights reserved.</center></h2>
<p>This software component is licensed by ST under BSD 3-Clause license, the "License"; You may not use this file except in compliance with the License. You may obtain a copy of the License at: opensource.org/licenses/BSD-3-Clause </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
